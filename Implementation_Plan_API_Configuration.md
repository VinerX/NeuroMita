### План реализации механизма конфигураций API

**Цель:** Создать механизм для управления несколькими конфигурациями API, позволяющий пользователю создавать, переключаться между ними, задавать им имена и сохранять их в отдельных файлах.

**Файлы для изменения:**

*   `SettingsManager.py` (для создания класса `APIConfigManager`)
*   `gui.py` (для интеграции с `ChatGUI`)
*   `ui/settings/api_settings.py` (для добавления новой секции в GUI)

**Детальный план реализации:**

1.  **Создание структуры файлов и базовой конфигурации:**
    *   Проверить наличие папки `Settings/API_Configs/`. Если ее нет, создать.
    *   Создать файл `Settings/API_Configs/default.json` с пустым шаблоном, включающим `gpt4free` по умолчанию.
2.  **Модификация `SettingsManager.py`:**
    *   Создать новый класс `APIConfigManager` со следующими методами:
        *   `load_configs()`: Загружает список доступных конфигураций из файлов в `Settings/API_Configs/`.
        *   `load_config(name)`: Загружает конкретную конфигурацию по имени.
        *   `save_config(name, config)`: Сохраняет конфигурацию в файл.
        *   `create_config(name)`: Создает новую конфигурацию (с копированием текущих значений или с пустым шаблоном).
        *   `delete_config(name)`: Удаляет конфигурацию.
        *   `set_active_config(name)`: Устанавливает активную конфигурацию (сохраняет в настройках приложения).
        *   `get_active_config()`: Возвращает имя активной конфигурации.
3.  **Интеграция в `ui/settings/api_settings.py`:**
    *   Добавить новую секцию в `setup_ui` для управления конфигурациями API.
    *   Добавить выпадающий список (Combobox) для выбора активной конфигурации.
    *   Добавить кнопку "Создать новую": Открывает диалог для ввода имени новой конфигурации.
    *   Добавить кнопку "Сохранить текущую": Сохраняет текущие значения полей API в активную конфигурацию.
    *   Добавить кнопку "Удалить текущую": Удаляет выбранную конфигурацию (с подтверждением).
    *   Существующие поля `NM_API_URL`, `NM_API_MODEL`, `NM_API_KEY`, `NM_API_KEY_RES`, `NM_API_REQ`, `GEMINI_CASE`, `gpt4free`, `gpt4free_model` будут динамически обновляться при переключении конфигураций.
4.  **Интеграция в `gui.py`:**
    *   В `__init__` `ChatGUI` инициализировать `APIConfigManager`.
    *   Загрузить активную конфигурацию при старте.
    *   Обновить логику `load_api_settings` и `all_settings_actions`:
        *   `load_api_settings` будет загружать данные из выбранного файла конфигурации.
        *   `all_settings_actions` будет сохранять изменения в текущую активную конфигурацию.
5.  **Обновление `ChatModel`:**
    *   `ChatModel` должен получать параметры API непосредственно из `ChatGUI` после загрузки.

**Диаграмма потока данных (Mermaid):**

```mermaid
graph TD
    A[Запуск программы] --> B{ChatGUI.__init__}
    B --> C[Инициализация APIConfigManager]
    C --> D[Загрузка списка конфигураций]
    D --> E[Загрузка активной конфигурации]
    E --> F[Обновление полей API в GUI]
    F --> G[Пользователь взаимодействует с GUI]

    G -- Выбор конфигурации --> H[APIConfigManager.load_config(name)]
    H --> F

    G -- Изменение поля API --> I[ChatGUI._save_setting]
    I --> J[APIConfigManager.save_config(current_config)]

    G -- Нажатие "Создать" --> K[Диалог ввода имени]
    K --> L[APIConfigManager.create_config(name)]
    L --> D

    G -- Нажатие "Удалить" --> M[Подтверждение]
    M --> N[APIConfigManager.delete_config(name)]
    N --> D

    J --> O[Обновление ChatModel]
    F --> O