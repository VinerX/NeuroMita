### План реализации механизма конфигураций API

**Цель:** Создать механизм для управления несколькими конфигурациями API, позволяющий пользователю создавать, переключаться между ними, задавать им имена и сохранять их в отдельных файлах.

**Структура хранения:**
*   Создать новую папку `Settings/API_Configs/` для хранения файлов конфигураций.
*   Каждая конфигурация будет отдельным JSON-файлом в этой папке (например, `default.json`, `my_config.json`).
*   Каждый файл конфигурации будет содержать следующие поля:
    *   `name`: Имя конфигурации (строка).
    *   `NM_API_KEY`: Ключ API (строка).
    *   `NM_API_URL`: URL API (строка).
    *   `NM_API_MODEL`: Модель API (строка).
    *   `NM_API_REQ`: Использовать Request (булево).
    *   `GEMINI_CASE`: Gemini для ProxiAPI (булево).
    *   `gpt4free`: Использовать gpt4free (булево).
    *   `gpt4free_model`: Модель gpt4free (строка).

**Основные шаги:**

1.  **Создание структуры файлов и базовой конфигурации:**
    *   При первом запуске или отсутствии папки `Settings/API_Configs/` создать ее.
    *   Создать файл `Settings/API_Configs/default.json` с пустым шаблоном, включающим `gpt4free` по умолчанию.

2.  **Модификация `SettingsManager` (или создание нового менеджера):**
    *   Создать новый класс `APIConfigManager` или расширить `SettingsManager` для работы с несколькими файлами конфигураций.
    *   Методы для:
        *   Загрузки списка доступных конфигураций.
        *   Загрузки конкретной конфигурации по имени.
        *   Сохранения текущей конфигурации.
        *   Создания новой конфигурации (с копированием текущих значений или с пустым шаблоном).
        *   Удаления конфигурации.
        *   Установки активной конфигурации.

3.  **Интеграция в `ChatGUI`:**
    *   **Инициализация:**
        *   В `__init__` `ChatGUI` инициализировать `APIConfigManager`.
        *   Загрузить активную конфигурацию при старте.
    *   **Элементы управления в GUI:**
        *   Добавить новую секцию в `setup_ui` для управления конфигурациями API.
        *   **Выпадающий список (Combobox):** Для выбора активной конфигурации.
        *   **Кнопка "Создать новую":** Открывает диалог для ввода имени новой конфигурации.
        *   **Кнопка "Сохранить текущую":** Сохраняет текущие значения полей API в активную конфигурацию.
        *   **Кнопка "Удалить текущую":** Удаляет выбранную конфигурацию (с подтверждением).
        *   **Поля ввода API:** Существующие поля `NM_API_URL`, `NM_API_MODEL`, `NM_API_KEY`, `NM_API_KEY_RES`, `NM_API_REQ`, `GEMINI_CASE`, `gpt4free`, `gpt4free_model` будут динамически обновляться при переключении конфигураций.
    *   **Обновление логики `load_api_settings` и `all_settings_actions`:**
        *   `load_api_settings` будет загружать данные из выбранного файла конфигурации.
        *   `all_settings_actions` будет сохранять изменения в текущую активную конфигурацию.
    *   **Обновление `ChatModel`:**
        *   `ChatModel` должен получать параметры API из `APIConfigManager` (или напрямую из `ChatGUI` после загрузки).

**Диаграмма потока данных (Mermaid):**

```mermaid
graph TD
    A[Запуск программы] --> B{ChatGUI.__init__}
    B --> C[Инициализация APIConfigManager]
    C --> D[Загрузка списка конфигураций]
    D --> E[Загрузка активной конфигурации]
    E --> F[Обновление полей API в GUI]
    F --> G[Пользователь взаимодействует с GUI]

    G -- Выбор конфигурации --> H[APIConfigManager.load_config(name)]
    H --> F

    G -- Изменение поля API --> I[ChatGUI._save_setting]
    I --> J[APIConfigManager.save_config(current_config)]

    G -- Нажатие "Создать" --> K[Диалог ввода имени]
    K --> L[APIConfigManager.create_config(name)]
    L --> D

    G -- Нажатие "Удалить" --> M[Подтверждение]
    M --> N[APIConfigManager.delete_config(name)]
    N --> D

    J --> O[Обновление ChatModel]
    F --> O